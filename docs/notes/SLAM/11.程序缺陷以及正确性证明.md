### 如何解决缺陷和程序正确性证明 - 讲座笔记

听完讲座，整体来说会有比较大的收获，能够将很多零碎的经验、知识点穿起来，而且引起了一些共鸣。下面我们具体谈一些一下细节，以及不一样的思考。

##### 思考：为什么要有这个讲座？

企业招人的时候，为什么“面试造火箭，入职拧螺丝”，会问一些入职之后用不到的问题？这些问题一方面包括**一些底层的原理**，例如各种 IO 通信模型、锁机制是怎么实现的，一方面是我们常说的**手撕算法**。

那很多人会疑惑，如果入职只是写一些业务代码的话，为什么还要深入的在这些知识点上考察候选人？和同事聊这个话题的时候，有一种观点是，如果候选人对这些底层的技术了解的比较透彻的话，说明他会有钻研的精神，在工作中遇到问题的时候能够更好的解决。就像学历的作用，为什么有的企业在招人的时候会比较看重本科的学校？是因为名校能体现出一个人的能力和聪明程度。一个清华的新闻学和一个不知名大学的计算机科班，在招人的时候会偏向于前者。

我们刚才说到面试还会考察**手撕算法**，虽然这些算法题在工作中从来不会用到，但是他考察的是一个人的基本素养。和同事聊天的时候他们提到过，在招人的时候，一个人的代码水平是最基本的考察要素，否则会带来很多问题，一个人的代码有 bug，如果自己去查的话，可能只要几个小时，如果自己查不出来，别人一路追踪追到这个 bug 的话，可能要花一个星期的时间以及需要投入很多精力。我们不希望说一个人写出的缺陷需要让一群人来帮忙查，所以面试的时候会比较看重代码水平。（讲座中也讲到，”制造缺陷是非常容易的，找出缺陷很难“）

##### 讲座笔记，以及一些共鸣点

造成缺陷的原因：复杂性

- 内在复杂性

  - 并发
  - 超大规模系统
  - 分布式系统与分布式算法
- 人为造成的混乱

  - 疏忽错误
  - 协作误解
    - 真实案例：某业务方要接入推荐中台，需要进行 id 系统的迁移。在业务代码中有一个 id 双发逻辑，删除旧 id 所在的特征，加入替换 id 之后的新特征，用新的 id 系统和旧的 id 系统同时训练模型。我的 mentor 在没有完全理解代码的情况下改了我的代码，改完之后发给我审查，我也没多想，稍微检查了一下逻辑，出于盲目信任，觉得肯定没问题，通过了他的代码 review，任务就上线了。导致线上事故，模型 AUC 下降，而且没有加监控预警，第二天才被业务方偶然发现。后来发了全网的事故通报以及事故复盘。
  - 祖传代码
- 常见缺陷种类

  - 编译链接问题
    - 找不到头文件、找不到库文件、缺少动态链接库
  - 语法问题
  - 内存访问缺陷
  - 逻辑缺陷
    - 读不懂的逻辑：只打布丁，不重构。真实案例：会有很多对性能追求极致的人，以及一些对整洁性追求极致的人，我们称作是一种”代码洁癖“，当然不是一个贬义词。例如，公司提交代码要走 review 流程，某业务方同学代码强制 merge，我们架构这边会觉得挺无语的，当时我们说，这个仓库后面要交给他们自己维护，随他们想怎么搞吧。
  - 随机缺陷
    - 生产环境出现，本地不出现：遇到过一个 flink 并行度导致重复调用 init 的问题，单例模式解决
- 调试器：常用调试功能、调试日志、可视化调试（例如 jvisual vm, 火焰图调内存问题）

程序正确性证明

- 程序正确性的形式化证明

解决缺陷的艺术

- 讲了最基本的排查思路

预防缺陷

- 重构、遵循软件工程原则...

测试与程序的正确性

- 测试是用来发现疏漏的，不是用来验证正确性的
- 各种正确性证明的实现

##### 听完讲座的感受

公司内部的文档经常被人吐槽说，文档是名词的罗列，是给懂得人看的。懂的人不需要看，不懂的人看了也不懂，是一个矛盾。所以很多新人如果经验比较少的话，会觉得压力比较大，一方面是文档看不懂，另一方面是大家都比较忙，问问题不知道从何问起、不知道问谁，所以这时候 mentor 就起到了作用。

类比公司内部的文档的问题，来看咱们的讲座，可能会有相似的感受，即：

- 对于**有经验的点**会有共鸣
- 有过一些**只是听说过的点**，听了之后会有新的收获，相当于把一些之前脑子里零碎的知识点穿起来了
- 对于那些**完全没有经验的知识点**，可能会记不住。不过听完之后，至少有一个整体的概念，经验上的问题还是要靠自己踩坑才会印象比较深。